/*! responsiveCarousel.JS - v1.2.0
 * http://basilio.github.com/responsiveCarousel
 *
 * Copyright (c) 2013 Basilio C‡ceres <basilio.caceres@gmail.com>;
 * Licensed under the MIT license */

!function(e){"use strict";e.fn.carousel=function(i){var t,a;return t={infinite:!0,visible:1,speed:"fast",overflow:!1,autoRotate:!1,navigation:e(this).data("navigation"),itemMinWidth:0,itemEqualHeight:!1,itemMargin:0,itemClassActive:"crsl-active",imageWideClass:"wide-image",carousel:!0,pager:!1,pagerId:e(this).data("pager"),pagerClassActive:"crsl-pager-active"},e(this).each(function(){a=e(this),e.isEmptyObject(i)===!1&&e.extend(t,i),e.isEmptyObject(e(a).data("crsl"))===!1&&e.extend(t,e(a).data("crsl")),t.isTouch="ontouchstart"in document.documentElement||navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)?!0:!1,a.init=function(){t.total=e(a).find(".crsl-item").length,t.itemWidth=e(a).outerWidth(),t.visibleDefault=t.visible,t.swipeDistance=null,t.swipeMinDistance=100,t.startCoords={},t.endCoords={},e(a).css({width:"100%"}),e(a).find(".crsl-item").css({position:"relative","float":"left",overflow:"hidden",height:"auto"}),e(a).find("."+t.imageWideClass).each(function(){e(this).css({display:"block",width:"100%",height:"auto"})}),e(a).find(".crsl-item iframe").attr({width:"100%"}),t.carousel&&e(a).find(".crsl-item:first-child").addClass(t.itemClassActive),t.carousel&&t.infinite&&t.visible<t.total&&e(a).find(".crsl-item:first-child").before(e(".crsl-item:last-child",a)),t.overflow===!1?e(a).css({overflow:"hidden"}):e("html, body").css({"overflow-x":"hidden"}),e(a).trigger("initCarousel",[t,a]),a.testPreload(),a.config(),a.initRotate(),t.pager&&(a.loadpagers(),e("#"+t.pagerId).find(".crsl-pager-item:first-child").addClass(t.pagerClassActive)),a.triggerNavs()},a.loadpagers=function(){for(var i="",a=0;a<t.total;a++)i+="<span class='crsl-pager-item'></span>";e("#"+t.pagerId).append(i)},a.testPreload=function(){if(e(a).find("img").length>0){var i=e(a).find("img").length,r=1;e(a).find("img").each(function(){a.preloadImage(this,r,i),r++})}else e(a).trigger("loadedCarousel",[t,a])},a.preloadImage=function(i,r,n){var s=new Image,o={};o.src=void 0!==e(i).attr("src")?i.src:"",o.alt=void 0!==e(i).attr("alt")?i.alt:"",e(s).attr(o),e(s).on("load",function(){1===r&&e(a).trigger("loadingImagesCarousel",[t,a]),r===n&&e(a).trigger("loadedImagesCarousel",[t,a])})},a.config=function(){t.itemWidth=Math.floor((e(a).outerWidth()-t.itemMargin*(t.visibleDefault-1))/t.visibleDefault),t.itemWidth<=t.itemMinWidth?(t.visible=1===Math.floor((e(a).outerWidth()-t.itemMargin*(t.visible-1))/t.itemMinWidth)?Math.floor(e(a).outerWidth()/t.itemMinWidth):Math.floor((e(a).outerWidth()-t.itemMargin)/t.itemMinWidth),t.visible=t.visible<1?1:t.visible,t.itemWidth=1===t.visible?Math.floor(e(a).outerWidth()):Math.floor((e(a).outerWidth()-t.itemMargin*(t.visible-1))/t.visible)):t.visible=t.visibleDefault,t.carousel?(a.wrapWidth=Math.floor((t.itemWidth+t.itemMargin)*t.total),a.wrapMargin=a.wrapMarginDefault=t.infinite&&t.visible<t.total?parseInt(-1*(t.itemWidth+t.itemMargin),10):0,t.infinite&&t.visible<t.total&&0===e(a).find(".crsl-item."+t.itemClassActive).index()&&(e(a).find(".crsl-item:first-child").before(e(".crsl-item:last-child",a)),a.wrapMargin=a.wrapMarginDefault=parseInt(-1*(t.itemWidth+t.itemMargin),10)),e(a).find(".crsl-wrap").css({width:a.wrapWidth+"px",marginLeft:a.wrapMargin})):(a.wrapWidth=e(a).outerWidth(),e(a).find(".crsl-wrap").css({width:a.wrapWidth+t.itemMargin+"px"}),e("#"+t.navigation).hide(),t.pager&&e("#"+t.pagerId).hide()),e(a).find(".crsl-item").css({width:t.itemWidth+"px",marginRight:t.itemMargin+"px"}),a.equalHeights(),t.carousel&&(t.visible>=t.total?(t.autoRotate=!1,e("#"+t.navigation).hide(),t.pager&&e("#"+t.pagerId).hide()):(e("#"+t.navigation).show(),t.pager&&e("#"+t.pagerId).show()))},a.equalHeights=function(){if(t.itemEqualHeight!==!1){var i=0;e(a).find(".crsl-item").each(function(){e(this).css({height:"auto"}),e(this).outerHeight()>i&&(i=e(this).outerHeight())}),e(a).find(".crsl-item").css({height:i+"px"})}return!0},a.initRotate=function(){t.autoRotate!==!1&&(a.rotateTime=window.setInterval(function(){a.rotate()},t.autoRotate))},a.triggerNavs=function(){e("#"+t.navigation).delegate(".previous, .next","click",function(i){if(i.preventDefault(),a.prepareExecute(),e(this).hasClass("previous")&&a.testPrevious(a.itemActive))a.previous();else{if(!e(this).hasClass("next")||!a.testNext())return;a.next()}})},a.prepareExecute=function(){return t.autoRotate&&clearInterval(a.rotateTime),a.preventAnimateEvent(),a.itemActive=e(a).find(".crsl-item."+t.itemClassActive),t.pager&&(a.pagerActive=e("#"+t.pagerId).find(".crsl-pager-item."+t.pagerClassActive)),!0},a.preventAnimateEvent=function(){return e(a).find(".crsl-wrap:animated").length>0?!1:void 0},a.rotate=function(){return a.preventAnimateEvent(),a.itemActive=e(a).find(".crsl-item."+t.itemClassActive),t.pager&&(a.pagerActive=e(a).find(".crsl-pager-item."+t.pagerClassActive)),a.next(),!0},a.testPrevious=function(i){return e(".crsl-wrap",a).find(".crsl-item").index(i)>0},a.testNext=function(){return!t.infinite&&a.wrapWidth>=(t.itemWidth+t.itemMargin)*(t.visible+1)-a.wrapMargin||t.infinite},a.previous=function(){a.wrapMargin=t.infinite?a.wrapMarginDefault+e(a.itemActive).outerWidth(!0):a.wrapMargin+e(a.itemActive).outerWidth(!0);var i=(e(a.itemActive).index(),e(a.itemActive).prev(".crsl-item"));if(t.pager){var r,n=e(a.pagerActive).index();r=0==n?e("#"+t.pagerId).find(".crsl-pager-item").last():e(a.pagerActive).prev(".crsl-pager-item")}var s="previous";e(a).trigger("beginCarousel",[t,a,s]),e(a).find(".crsl-wrap").animate({marginLeft:a.wrapMargin+"px"},t.speed,function(){e(a.itemActive).removeClass(t.itemClassActive),e(i).addClass(t.itemClassActive),t.pager&&(e(a.pagerActive).removeClass(t.pagerClassActive),e(r).addClass(t.pagerClassActive)),t.infinite?e(this).css({marginLeft:a.wrapMarginDefault}).find(".crsl-item:first-child").before(e(".crsl-item:last-child",a)):(a.testPrevious(i)===!1&&e("#"+t.navigation).find(".previous").addClass("previous-inactive"),a.testNext()&&e("#"+t.navigation).find(".next").removeClass("next-inactive")),e(this).trigger("endCarousel",[t,a,s])})},a.next=function(){a.wrapMargin=t.infinite?a.wrapMarginDefault-e(a.itemActive).outerWidth(!0):a.wrapMargin-e(a.itemActive).outerWidth(!0);var i=(e(a.itemActive).index(),e(a.itemActive).next(".crsl-item"));if(t.pager){var r,n=e(a.pagerActive).index();r=n!=t.total-1?e(a.pagerActive).next(".crsl-pager-item"):e("#"+t.pagerId).find(".crsl-pager-item").first()}var s="next";e(a).trigger("beginCarousel",[t,a,s]),e(a).find(".crsl-wrap").animate({marginLeft:a.wrapMargin+"px"},t.speed,function(){e(a.itemActive).removeClass(t.itemClassActive),e(i).addClass(t.itemClassActive),t.pager&&(e(a.pagerActive).removeClass(t.pagerClassActive),e(r).addClass(t.pagerClassActive)),t.infinite?e(this).css({marginLeft:a.wrapMarginDefault}).find(".crsl-item:last-child").after(e(".crsl-item:first-child",a)):(a.testPrevious(i)&&e("#"+t.navigation).find(".previous").removeClass("previous-inactive"),a.testNext()===!1&&e("#"+t.navigation).find(".next").addClass("next-inactive")),e(this).trigger("endCarousel",[t,a,s])})};var r,n=!1;e(window).on("mouseleave",function(i){return i.target?r=i.target:i.srcElement&&(r=i.srcElement),n=e(a).attr("id")&&e(r).parents(".crsl-items").attr("id")===e(a).attr("id")||e(r).parents(".crsl-items").data("navigation")===e(a).data("navigation")?!0:!1,!1}),e(window).on("keydown",function(e){n===!0&&(37===e.keyCode?(a.prepareExecute(),a.previous()):39===e.keyCode&&(a.prepareExecute(),a.next()))}),t.isTouch&&e(a).on("touchstart",function(i){e(a).addClass("touching"),t.startCoords.pageX=t.endCoords.pageX=i.originalEvent.targetTouches[0].pageX,t.startCoords.pageY=t.endCoords.pageY=i.originalEvent.targetTouches[0].pageY,e(".touching").on("touchmove",function(e){t.endCoords.pageX=e.originalEvent.targetTouches[0].pageX,t.endCoords.pageY=e.originalEvent.targetTouches[0].pageY,Math.abs(parseInt(t.endCoords.pageX-t.startCoords.pageX,10))>Math.abs(parseInt(t.endCoords.pageY-t.startCoords.pageY,10))&&(e.preventDefault(),e.stopPropagation())})}).on("touchend",function(i){t.swipeDistance=t.endCoords.pageX-t.startCoords.pageX,t.swipeDistance>=t.swipeMinDistance?(a.prepareExecute(),a.previous(),i.preventDefault(),i.stopPropagation()):t.swipeDistance<=-t.swipeMinDistance&&(a.prepareExecute(),a.next(),i.preventDefault(),i.stopPropagation()),e(".touching").off("touchmove").removeClass("touching")}),e(a).on("loadedCarousel loadedImagesCarousel",function(){a.equalHeights()}),e(window).on("carouselResizeEnd",function(){t.itemWidth!==e(a).outerWidth()&&a.config()}),e(window).ready(function(){e(a).trigger("prepareCarousel",[t,a]),a.init(),e(window).on("resize",function(){this.carouselResizeTo&&clearTimeout(this.carouselResizeTo),this.carouselResizeTo=setTimeout(function(){e(this).trigger("carouselResizeEnd")},10)})}),e(window).load(function(){a.testPreload(),a.config()})})}}(jQuery);